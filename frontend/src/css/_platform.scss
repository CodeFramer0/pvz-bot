@use 'variables' as *;
@use 'mixins' as *;

// ════════════════════════════════════════════════════════════
// PLATFORM.SCSS
// Специфические фиксы для iOS PWA / Android Capacitor / PWA
// ════════════════════════════════════════════════════════════

// ─── Global Base ─────────────────────────────────────────────

*,
*::before,
*::after {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent; // убираем синий flash на тап
}

html {
  overscroll-behavior: none;
  -webkit-user-select: none;
  user-select: none;
}

input, textarea, [contenteditable] {
  -webkit-user-select: text;
  user-select: text;
}

body {
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

// ─── iOS PWA Specific ────────────────────────────────────────

@include ios-pwa {
  body {
    position: fixed;
    width: 100%;
    overflow: hidden;
  }

  .q-page-container {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    height: 100vh;
  }

  .pvz-page-header,
  .pvz-hero-header,
  .detail-hero,
  .pvz-auth-page {
    padding-top: calc(16px + env(safe-area-inset-top));
  }
}

// ─── Safe Area — применяется везде (iOS + Android cutout) ────

.pvz-page-header {
  padding-top: calc(16px + env(safe-area-inset-top, 0px));
}

.pvz-hero-header {
  padding-top: calc(24px + env(safe-area-inset-top, 0px));
}

.q-footer,
.q-tabs--bottom {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.pvz-page {
  @include touch {
    padding-bottom: calc(#{$page-padding-b} + env(safe-area-inset-bottom, 0px));
  }
}

.pvz-auth-page,
.pvz-no-tabs {
  padding-bottom: env(safe-area-inset-bottom, 0px) !important;
}

.pvz-page-header,
.pvz-hero-header,
.detail-content,
.profile-container,
.form-container,
.q-px-md {
  padding-left: max(16px, calc(16px + env(safe-area-inset-left, 0px)));
  padding-right: max(16px, calc(16px + env(safe-area-inset-right, 0px)));
}

// ─── Android Capacitor Specific ──────────────────────────────

.capacitor-android {
  .pvz-page-header,
  .pvz-hero-header {
    padding-top: calc(16px + env(safe-area-inset-top, 28px));
  }

  .q-footer {
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  * {
    @media (hover: none) {
      &:hover { background: unset !important; }
    }
  }
}

// ─── Touch Optimizations ─────────────────────────────────────

@include touch {
  button,
  .q-btn,
  .setting-item,
  .tab-item,
  .order-card,
  .pvz-order-card {
    min-height: 44px;
  }

  .pvz-order-card:hover,
  .setting-item:hover,
  .auth-tab:hover,
  .tab-item:hover {
    background: unset;
  }

  .pvz-order-card:active { transform: scale(0.98); }
  .pvz-stat-card:active  { transform: scale(0.95); }
  .setting-item:active   { background: $color-bg-page; }
}

// ─── Prevent Zoom on Input Focus (iOS) ───────────────────────

.q-field__native,
.q-field__input,
input[type],
select,
textarea {
  font-size: 16px !important;
}

// ─── Hide Scrollbar (Mobile) ─────────────────────────────────

@include touch {
  ::-webkit-scrollbar { display: none; }
  * { scrollbar-width: none; }
}